package com.beidao.netty.dubbo.decoder;import java.util.List;import com.beidao.netty.dubbo.serialize.NettyProtoBufRpcSerialize;import io.netty.buffer.ByteBuf;import io.netty.channel.ChannelHandlerContext;import io.netty.handler.codec.ByteToMessageDecoder;/** * @author beidao * */public class NettyNetMessageRPCDecoder extends ByteToMessageDecoder {	private Class<?> genericClass;	public NettyNetMessageRPCDecoder(Class<?> genericClass) {		this.genericClass = genericClass;	}	@Override	protected void decode(ChannelHandlerContext ctx, ByteBuf in, List<Object> out) throws Exception {		if (in.readableBytes() < 4) {			return;		}		in.markReaderIndex();		int dataLength = in.readInt();		/*		 * if (dataLength <= 0) { ctx.close(); }		 */		if (in.readableBytes() < dataLength) {			in.resetReaderIndex();			return;		}		byte[] data = new byte[dataLength];		in.readBytes(data);		Object obj = NettyProtoBufRpcSerialize.deserialize(data, genericClass);		out.add(obj);	}}